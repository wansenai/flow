var e=(e,t,n)=>new Promise(((o,i)=>{var r=e=>{try{a(n.next(e))}catch(t){i(t)}},s=e=>{try{a(n.throw(e))}catch(t){i(t)}},a=e=>e.done?o(e.value):Promise.resolve(e.value).then(r,s);a((n=n.apply(e,t)).next())}));import{_ as t}from"./TableImg.c9ed598a.js";import{g as n}from"./BasicForm.ae4250e1.js";import{u as o}from"./useTable.26f8956b.js";import{g as i,c as r,s,a,b as l,d,p as c,e as p,f as u}from"./listener.data.d62505c8.js";import{z as m,b4 as f,r as b,X as h,u as g,Z as y,D as j,F as x,w as T,a3 as v,a9 as P,J as S,a8 as C}from"./vendor.11d66826.js";/* empty css              */import w from"./ListenerModal.95ac55a2.js";import M from"./ListenerPropertiesModal.80f6b7c8.js";import{b as R}from"./index.5b995397.js";/* empty css              *//* empty css              */import"./useForm.213a5276.js";import"./index.514e05b1.js";/* empty css              *//* empty css              */import"./uuid.2b29000c.js";import"./useWindowSizeFn.9fecf134.js";import"./onMountedOrActivated.17f3c81d.js";/* empty css              */import"./useSortable.6a86578b.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index.6b57f630.js";/* empty css              *//* empty css              *//* empty css              */import"./download.0adfd0af.js";import"./base64Conver.bb012c73.js";import"./index.ceaa815e.js";var F=m({name:"FlowListener",components:{Tag:f,BasicTable:t,TableAction:n,ListenerModal:w,ListenerPropertiesModal:M},setup(){const[t,{openModal:n,setModalProps:m}]=R(),f=b({}),y=b({}),j=b({}),x=b(!1),T=b([]),v=b({}),[P,{openModal:S,setModalProps:C}]=R(),[w,{reload:M,getForm:F,setProps:L}]=o({title:"列表",api:i,columns:r,formConfig:{labelWidth:80,schemas:s,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},expandedRowKeys:T,expandRowByClick:!0,useSearchForm:!0,bordered:!0,showIndexColumn:!0,showTableSetting:!1,pagination:!1,rowKey:"id",canResize:!0,onExpand:(e,t)=>{e?(T.value=[t.id],v.value=t,k(t.id)):T.value=[]},resizeHeightOffset:-50});function k(e){x.value=!0,a({listenerId:e}).then((t=>{t&&t.length>0?f.value[e]=t:f.value[e]=[]})).finally((()=>{x.value=!1}))}return h((()=>{l().then((e=>{e.forEach((e=>{g(y)[e.value]=e.label}))}));const{updateSchema:t}=F();d().then((n=>{n.forEach((e=>{g(j)[e.value]=e.label})),t([{field:"listenerType",componentProps:{options:n,onChange:t=>e(this,[t],(function*({target:e}){const{setFieldsValue:t}=F();yield t({name:""}),L({searchInfo:{listenerType:e.value}}),M()}))}}])}))})),{registerTable:w,registerModal:t,registerPropertiesModal:P,expressionTypeObj:y,listenerTypeObj:j,propertiesColumns:c,listenerPropertiesData:f,propertiesTableLoading:x,handleDeleteProperty:function(e){u(e.id).then((()=>{k(g(v).id)})).finally((()=>{}))},handleCloseFunc:function(){return M(),Promise.resolve(!0)},handleCreate:function(){return e(this,null,(function*(){const{validate:e}=F(),t=yield e();n(!0,{isUpdate:!1,record:{listenerType:t.listenerType||"taskListener"}}),m({title:"新增监听"})}))},handleEditProperties:function(e){S(!0,{isUpdate:!0,record:e}),C({title:`修改【${e.name}】的属性`})},handleAddProperties:function(e,t){t.stopPropagation(),v.value=e,S(!0,{isUpdate:!1,record:{listenerId:e.id,type:"string"}}),C({title:`添加【${e.name}】的属性`})},handleEdit:function(e,t){t.stopPropagation(),n(!0,{record:e,isUpdate:!0})},handleDelete:function(e,t){t.stopPropagation(),p(e.id).then((()=>{M()}))},handleSuccess:function(){M()},handleUpdateSecretKeySuccess:function(){k(g(v).id),T.value=[g(v).id]}}}});const L=P(" 新增 ");F.render=function(e,t,n,o,i,r){const s=y("a-button"),a=y("TableAction"),l=y("Tag"),d=y("BasicTable"),c=y("ListenerModal"),p=y("ListenerPropertiesModal");return j(),x("div",null,[T(d,{onRegister:e.registerTable,dense:"",contentFullHeight:"",fixedHeight:""},{toolbar:v((()=>[T(s,{type:"primary",onClick:e.handleCreate},{default:v((()=>[L])),_:1},8,["onClick"])])),action:v((({record:t})=>[T(a,{actions:[{icon:"ant-design:plus-outlined",tooltip:"添加参数",onClick:e.handleAddProperties.bind(null,t)},{tooltip:"修改",icon:"clarity:note-edit-line",onClick:e.handleEdit.bind(null,t)},{tooltip:"删除",icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"是否确认删除",confirm:e.handleDelete.bind(null,t)}}]},null,8,["actions"])])),typeRender:v((({record:t})=>[P(S(e.expressionTypeObj[t.type]),1)])),listenerTypeRender:v((({record:t})=>["taskListener"===t.listenerType?(j(),x(l,{key:0,color:"default"},{default:v((()=>[P(S(e.listenerTypeObj[t.listenerType]),1)])),_:2},1024)):C("",!0),"executionListener"===t.listenerType?(j(),x(l,{key:1,color:"processing"},{default:v((()=>[P(S(e.listenerTypeObj[t.listenerType]),1)])),_:2},1024)):C("",!0)])),expandedRowRender:v((({record:t,index:n,indent:o,expanded:i})=>[T(d,{title:"",size:"small",columns:e.propertiesColumns,useSearchForm:!1,immediate:!1,showIndexColumn:!0,showTableSetting:!1,bordered:!0,pagination:!1,emptyDataIsShowTable:!1,inset:!0,actionColumn:"{\r\n            align: 'center'\r\n          }",rowKey:"id",canResize:!1,loading:e.propertiesTableLoading,dataSource:e.listenerPropertiesData[t.id]},{action:v((({record:t})=>[T(a,{actions:[{icon:"clarity:note-edit-line",title:"编辑",onClick:e.handleEditProperties.bind(null,t)},{icon:"ant-design:delete-outlined",color:"error",title:"删除",popConfirm:{title:"是否确认删除",confirm:e.handleDeleteProperty.bind(null,t)}}]},null,8,["actions"])])),_:2},1032,["columns","loading","dataSource"])])),_:1},8,["onRegister"]),T(c,{onRegister:e.registerModal,onSuccess:e.handleSuccess},null,8,["onRegister","onSuccess"]),T(p,{onRegister:e.registerPropertiesModal,onSuccess:e.handleUpdateSecretKeySuccess,closeFunc:e.handleCloseFunc},null,8,["onRegister","onSuccess","closeFunc"])])};export default F;
